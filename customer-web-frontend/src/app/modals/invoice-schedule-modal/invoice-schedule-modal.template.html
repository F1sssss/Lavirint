<form name="ctrl.form" class="d-flex flex-column h-100" novalidate>
    <div class="modal-header">
        <div class="d-flex justify-content-between align-items-center w-100">
            <div class="fw-bold">Ponavljanje fiskalizacije</div>
            <button type="button" class="btn btn-link text-decoration-none fw-bold" ng-click="$close({ isConfirmed: false });">
                Zatvori
            </button>
        </div>
    </div>
    <div class="modal-header d-md-none p-0 position-sticky top-0">
        <div class="w-100 d-flex justify-content-between">
            <div>
                <button type="button" class="btn rounded-0" data-ng-click="$close({ isConfirmed: false })">
                    <i class="fa fa-arrow-left"></i> Nazad
                </button>
            </div>
            <div>
                <button type="button" class="btn btn-link text-decoration-none rounded-0" data-ng-click="ctrl.confirm()">
                    Potvrdi
                </button>
            </div>
        </div>
    </div>
    <div class="modal-body overflow-y-auto">
        <div class="p-5 text-center" ng-show="ctrl.isLoading">
            <div class="spinner-border spinner-lg" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div class="row g-3" ng-show="!ctrl.isLoading">
            <div class="col-12">
                <label for="frequency_interval" class="form-label">Interval (broj mjeseci)</label>
                <input id="frequency_interval" type="number" class="form-control" ng-model="ctrl.invoice_schedule.frequency_interval">
            </div>
            <div class="col-12">
                <label for="start_datetime" class="form-label">Početak</label>
                <div class="d-flex">
                    <div class="input-group" style="max-width: 170px;">
                        <input type="text"
                               class="form-control"
                               uib-datepicker-popup
                               is-open="startDatePickerIsOpen"
                               name="start_datetime"
                               id="start_datetime"
                               ng-model="ctrl.invoice_schedule.start_datetime"
                               ng-model-options="{ allowInvalid: true }"
                               fis-min-date
                               required
                               pattern="\d{4}-\d{2}-\d{2}">
                        <button type="button" class="btn btn-light border rounded-end" ng-click="startDatePickerIsOpen = !startDatePickerIsOpen">
                            <i class="fa fa-calendar"></i>
                        </button>
                    </div>
                    <div uib-timepicker
                         ng-model="ctrl.invoice_schedule.start_datetime"
                         class="ms-2"
                         show-seconds="false"
                         fis-min-date></div>
                </div>
                <div ng-messages="ctrl.form.start_datetime.$error" role="alert" class="invalid-feedback">
                    <div ng-messages-include="error-messages"></div>
                </div>
            </div>
            <div class="col-12">
                {{ ctrl.form.start_datetime }}
            </div>
            <div class="col-12">
                <label class="form-label" class="form-label">Kraj</label>
                <div class="p-3 bg-opacity-10 border rounded-top" ng-class="{ 'bg-primary border-primary position-relative': ctrl.endDatetimeMode === 1, 'bg-light': ctrl.endDatetimeMode !== 1 }" ng-click="ctrl.setEndDatetimeMode(1)">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" ng-model="ctrl.endDatetimeMode" ng-value="1" id="flexRadioDefault1">
                        <label class="form-check-label" for="flexRadioDefault1">
                            Neograničeno, fiskalizacija će se ponavljati dok ne promijenite podešavanja.
                        </label>
                    </div>
                </div>
                <div class="p-3 bg-opacity-10 border rounded-bottom"
                     style="margin-top: -1px;"
                     ng-class="{ 'bg-primary border-primary position-relative': ctrl.endDatetimeMode === 2, 'bg-light': ctrl.endDatetimeMode !== 2 }" ng-click="ctrl.setEndDatetimeMode(2)" >
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" ng-model="ctrl.endDatetimeMode" ng-value="2" id="flexRadioDefault2">
                        <label class="form-check-label" for="flexRadioDefault2">
                            Do datuma
                        </label>
                    </div>
                    <div class="input-group" style="max-width: 170px;" ng-class="{ 'pe-none opacity-50': ctrl.endDatetimeMode !== 2 }">
                        <input type="text"
                               class="form-control"
                               uib-datepicker-popup
                               is-open="endDatePickerIsOpen"
                               name="end_datetime"
                               id="end_datetime"
                               ng-model="ctrl.invoice_schedule.end_datetime"
                               ng-required="ctrl.endDatetimeMode === 2"
                               pattern="\d{4}-\d{2}-\d{2}"
                               ng-change="ctrl.invoice_schedule.end_datetime = ctrl.invoice_schedule.end_datetime">
                        <button type="button" class="btn btn-light border rounded-end" ng-click="endDatePickerIsOpen = !endDatePickerIsOpen; $event.stopPropagation();">
                            <i class="fa fa-calendar"></i>
                        </button>
                        <div ng-messages="ctrl.form.end_datetime.$error" role="alert" class="invalid-feedback">
                            <div ng-messages-include="error-messages"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" ng-click="ctrl.confirm()">
            Potvrdi
        </button>
    </div>
</form>
